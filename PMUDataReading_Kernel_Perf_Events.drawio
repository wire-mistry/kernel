<mxfile host="www.draw.io" modified="2020-02-25T07:07:55.561Z" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.106 Safari/537.36" etag="k7q5jh2B7dR1Dgz36GCl" version="12.7.2" type="github">
  <diagram id="Z9IFnxMjQq6kRPbSj0s-" name="Page-1">
    <mxGraphModel dx="1102" dy="582" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="3300" pageHeight="4681" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="VzNv1Wdzh7wUnMC-2EBl-1" value="&lt;h1&gt;Few quick steps for configuring perf kernel events (PMU of ARM)&lt;/h1&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;The API List&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;ul&gt;&lt;li&gt;&lt;b&gt;/include/&lt;/b&gt;&lt;b&gt;linux/perf_event.h&lt;/b&gt;&lt;/li&gt;&lt;li&gt;&lt;b&gt;The main API -&amp;nbsp;&lt;a href=&quot;https://elixir.bootlin.com/linux/latest/ident/perf_event_read_value&quot; style=&quot;font-family: &amp;#34;ubuntu mono&amp;#34; , monospace ; font-size: 0.9em ; box-sizing: inherit ; background-color: rgb(244 , 246 , 255) ; box-shadow: rgb(244 , 246 , 255) 0px 0px 0px 1px ; border-radius: 0.2em&quot;&gt;perf_event_read_value&lt;/a&gt;&lt;b&gt;()&lt;/b&gt;&lt;br&gt;&lt;/b&gt;&lt;/li&gt;&lt;li&gt;&lt;b&gt;Configuration/setup Steps&lt;/b&gt;&lt;/li&gt;&lt;ul&gt;&lt;li&gt;Assign attributes for the counter&lt;/li&gt;&lt;ul&gt;&lt;li&gt;The struct&amp;nbsp;&lt;a href=&quot;https://elixir.bootlin.com/linux/latest/ident/perf_event&quot; style=&quot;font-family: &amp;#34;ubuntu mono&amp;#34; , monospace ; font-size: 0.9em ; box-sizing: inherit ; background-color: rgb(244 , 246 , 255) ; font-weight: 700 ; box-shadow: rgb(244 , 246 , 255) 0px 0px 0px 1px ; border-radius: 0.2em ; border-bottom: 1px dotted rgb(0 , 0 , 0)&quot;&gt;perf_event&lt;/a&gt;&amp;nbsp;has &lt;a href=&quot;https://elixir.bootlin.com/linux/latest/source/include/linux/perf_event.h#L664&quot;&gt;attr&lt;/a&gt;&amp;nbsp;member of type&amp;nbsp;&lt;a href=&quot;https://elixir.bootlin.com/linux/latest/ident/perf_event_attr&quot; style=&quot;font-family: &amp;#34;ubuntu mono&amp;#34; , monospace ; font-size: 0.9em ; box-sizing: inherit ; background-color: rgb(244 , 246 , 255) ; font-weight: 700 ; box-shadow: rgb(244 , 246 , 255) 0px 0px 0px 1px ; border-radius: 0.2em ; border-bottom: 1px dotted rgb(0 , 0 , 0)&quot;&gt;perf_event_attr&lt;/a&gt;&amp;nbsp;it has to be init with required values i.e. attr-&amp;gt;size, attr-&amp;gt;type, attr-&amp;gt;pinned,attr-&amp;gt;exclude_idle etc.&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;With the assiged attributes use api&amp;nbsp;&lt;a href=&quot;https://elixir.bootlin.com/linux/latest/ident/perf_event_create_kernel_counter&quot; style=&quot;font-family: &amp;#34;ubuntu mono&amp;#34; , monospace ; font-size: 0.9em ; box-sizing: inherit ; background-color: rgb(244 , 246 , 255) ; font-weight: 700 ; box-shadow: rgb(244 , 246 , 255) 0px 0px 0px 1px ; border-radius: 0.2em ; border-bottom: 1px dotted rgb(0 , 0 , 0)&quot;&gt;perf_event_create_kernel_counter&lt;/a&gt;, and use for the dedicated cpu, the other arguments could be null or be utilized as required&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://elixir.bootlin.com/linux/latest/ident/perf_event_create_kernel_counter&quot; style=&quot;font-family: &amp;#34;ubuntu mono&amp;#34; , monospace ; font-size: 0.9em ; box-sizing: inherit ; background-color: rgb(244 , 246 , 255) ; font-weight: 700 ; box-shadow: rgb(244 , 246 , 255) 0px 0px 0px 1px ; border-radius: 0.2em ; border-bottom: 1px dotted rgb(0 , 0 , 0)&quot;&gt;perf_event_create_kernel_counter&lt;/a&gt;&amp;nbsp;return a perf_event structure pointer pass this structure pointer with all safe checks to&amp;nbsp;&lt;a href=&quot;https://elixir.bootlin.com/linux/latest/ident/perf_event_enable&quot; style=&quot;font-family: &amp;#34;ubuntu mono&amp;#34; , monospace ; font-size: 0.9em ; box-sizing: inherit ; background-color: rgb(244 , 246 , 255) ; font-weight: 700 ; box-shadow: rgb(244 , 246 , 255) 0px 0px 0px 1px ; border-radius: 0.2em ; border-bottom: 1px dotted rgb(0 , 0 , 0)&quot;&gt;perf_event_enable&lt;/a&gt;&amp;nbsp;to enable the counter&lt;/li&gt;&lt;li&gt;and then further reading can be done with perf_event_Read_value() this function takes the perf_event structure returned by the&amp;nbsp;&lt;a href=&quot;https://elixir.bootlin.com/linux/latest/ident/perf_event_create_kernel_counter&quot; style=&quot;font-family: &amp;#34;ubuntu mono&amp;#34; , monospace ; font-size: 0.9em ; box-sizing: inherit ; background-color: rgb(244 , 246 , 255) ; font-weight: 700 ; box-shadow: rgb(244 , 246 , 255) 0px 0px 0px 1px ; border-radius: 0.2em ; border-bottom: 1px dotted rgb(0 , 0 , 0)&quot;&gt;perf_event_create_kernel_counter&lt;/a&gt;, hence this is meaning ful to save the return values for further reads.&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="80" y="40" width="840" height="310" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
